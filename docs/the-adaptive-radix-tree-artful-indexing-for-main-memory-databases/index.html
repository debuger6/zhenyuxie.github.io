<!doctype html><html lang=zh-cn data-theme=light><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.109.0"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content><meta itemprop=description content="Simple is the best."><meta itemprop=image content="/imgs/hugo_next_avatar.png"><meta itemprop=keywords content="技术,知识"><meta property="og:type" content="article"><meta property="og:title" content="debuger"><meta property="og:description" content="Simple is the best."><meta property="og:image" content="/imgs/hugo_next_avatar.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="/the-adaptive-radix-tree-artful-indexing-for-main-memory-databases/"><meta property="og:site_name" content="debuger"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="debuger"><meta property="article:published_time" content="0001-01-01 00:00:00 +0000 UTC"><meta property="article:modified_time" content="0001-01-01 00:00:00 +0000 UTC"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.42b65f4b5d8fdb26467483a54df0d4f1570d2f58db628dde5a9075d4ba6c423c.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":true,"isHome":false,"isPage":true,"math":{"js":{"file":"es5/tex-mml-chtml.js","name":"mathjax","version":"3.2.0"},"render":"mathjax"},"path":"the-adaptive-radix-tree-artful-indexing-for-main-memory-databases","permalink":"/the-adaptive-radix-tree-artful-indexing-for-main-memory-databases/","title":"","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>- debuger</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label="Toggle navigation bar" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>debuger</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>大道至简</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>技术博客
<span class=badge>16</span></a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>Search</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=Searching... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>TOC</li><li class=sidebar-nav-overview>Overview</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=debuger src=/imgs/img-lazy-loading.gif data-src=/imgs/hugo_next_avatar.png><p class=site-author-name itemprop=name>debuger</p><div class=site-description itemprop=description>Simple is the best.</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>16</span>
<span class=site-state-item-name>Posts</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>11</span>
<span class=site-state-item-name>Categories</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>16</span>
<span class=site-state-item-name>Tags</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/debuger6 title="Github → https://github.com/debuger6" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>Github</a></span>
<span class=links-of-social-item><a href=https://www.zhihu.com/people/xzy-51-38 title="知乎 → https://www.zhihu.com/people/xzy-51-38" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-book fa-fw hvr-icon"></i>知乎</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title="Creative Commons"><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt="Creative Commons"></a></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>Web Status</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>Running:</div><div class=item-count id=runTimes data-publishdate=2022-01-20T22:00:00+00:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>Visitors:</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>Views:</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>Words:</div><div class=item-count id=wordsCount data-count=44429></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>ReadTime:</div><div class=item-count id=readTimes data-times=98></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>Last Update:</div><div class=item-count id=last-push-date data-lastpushdate=2023-09-05T23:00:00+00:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-comments class="button goto-comments" title="Go to Comment"><i class="fas fa-comments"></i></div><div id=goto-gtranslate class=button title="Multilingual translation"><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title="Change Theme"><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title="Back to Top"><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a>
<a href=https://github.com/debuger6 rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script>
<script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=/the-adaptive-radix-tree-artful-indexing-for-main-memory-databases/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/hugo_next_avatar.png"><meta itemprop=name content="debuger"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="debuger"><meta itemprop=description content="Simple is the best."></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content><meta itemprop=description content="自适应基数树（Adaptive Radix Tree）是一种高效的数据结构，用于存储和检索键值对。它是一种自适应的树结构，根据实际数据的分布情况来调整内部节点的结构，以提高性能和减少存储空间的使用。
Trie Trie（也称为字典树或前缀树）是一种特殊的树型数据结构，用于有效地存储和检索字符串集合。Trie 的主要特点是将字符串分解成单个字符，并将每个字符存储在一个节点上。从根节点开始，每个节点都代表一个字符，通过连接各个节点来表示完整的字符串。Trie 的根节点通常不存储实际字符，而是用于连接所有的子节点。如下图：
在 trie 中查找某个 key，需要从根节点开始，根据要查找的字符串逐级向下遍历。如果在任何层级上找不到对应的子节点，则表示字符串不存在于 Trie 中。
比如，要查找字符串 pedro, 那么需要先查找根节点是否包含字符 p，如果包含，那么检查下一层是否包含字符 e，如此这般，直到最后一个字符也包含在一个终止节点（表示从根节点到该节点为一个完整字符串），如下图蓝色路径则为字符串 pedro 的查找路径。
Trie 的主要优点是：
高效地插入和查找字符串，时间复杂度为 $O(k)$，其中 $k$ 是字符串的长度。 可以高效地进行前缀匹配，用于实现自动补全、单词搜索等。 实际上，Trie 也可以用来存储数值类型的数据。对于 uint64 的数值，最大为 18,446,744,073,709,551,615。如果按字符来存储，那么存储 uint64 的最大值需要 17 层，显然这种存储方式并不高效，那么如果我们按 bits 存储呢？uint64 有 64-bits，每个节点的 key 用 8-bits 表示，那么只需要 8 层即可。
我们以每个节点存 2-bits 为例，假设 Trie 中存储了 7, 10, 12，从下图可以看到这三个数的二进制表示。每个节点的值由 0 和 1 组成，同时每个节点包含指向所有子节点的指针，指针为 * 代表该子节点存在，指针为 Ø 代表改子节点不存在。最终由叶子节点指向实际的数据。
然而，我们可以很容易看出，上述 Trie 有两个缺点：
有的节点只有一个子节点，既增加了层级也浪费了空间 有的节点存在大量空指针，浪费空间。 为了解决上述问题，一般使用压缩技术来达到节约空间的目的。
Radix tree Radix tree（基数树，也称为压缩前缀树或 Patricia 树）是一种特殊的多叉树数据结构，用于高效地存储、检索和查找字符串键（key）和与之相关联的值（value）。它被广泛用于实现诸如IP路由表、字典、自动补全和编译器等应用。"></span><header class=post-header><h1 class=post-title itemprop="name headline"></h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text>Publish on:</span>
<time title="Publish on:0001-01-01 00:00:00 +0000 UTC" itemprop="dateCreated datePublished" datetime="0001-01-01 00:00:00 +0000 UTC">0001-01-01</time></span></div><div class=post-meta-items><span class=post-meta-item title=Words><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>Words:</span><span>253</span></span>
<span class=post-meta-item title=Read><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>Read:&ap;</span>
<span>2min</span></span>
<span class=post-meta-item title=Views><span class=post-meta-item-icon><i class="far fa-eye"></i></span>
<span class=post-meta-item-text>Views:</span>
<span id=busuanzi_value_page_pv class=waline-pageview-count data-path=/the-adaptive-radix-tree-artful-indexing-for-main-memory-databases/><i class="fa fa-sync fa-spin"></i></span></span>
<span class=post-meta-item title=Comments><span class=post-meta-item-icon><i class="far fa-comments"></i></span>
<span class=post-meta-item-text>Comments:</span>
<span class=waline-comment-count data-path=/the-adaptive-radix-tree-artful-indexing-for-main-memory-databases/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><blockquote><p>自适应基数树（Adaptive Radix Tree）是一种高效的数据结构，用于存储和检索键值对。它是一种自适应的树结构，根据实际数据的分布情况来调整内部节点的结构，以提高性能和减少存储空间的使用。</p></blockquote><h1 id=trie>Trie</h1><p>Trie（也称为字典树或前缀树）是一种特殊的树型数据结构，用于有效地存储和检索字符串集合。Trie 的主要特点是将字符串分解成单个字符，并将每个字符存储在一个节点上。从根节点开始，每个节点都代表一个字符，通过连接各个节点来表示完整的字符串。Trie 的根节点通常不存储实际字符，而是用于连接所有的子节点。如下图：</p><img src=/Users/xzy/github.com/zhenyuxie/hugo-blog/content/images/database/string-trie.png alt="String Trie" style=zoom:67%><p>在 trie 中查找某个 key，需要从根节点开始，根据要查找的字符串逐级向下遍历。如果在任何层级上找不到对应的子节点，则表示字符串不存在于 Trie 中。</p><p>比如，要查找字符串 pedro, 那么需要先查找根节点是否包含字符 p，如果包含，那么检查下一层是否包含字符 e，如此这般，直到最后一个字符也包含在一个终止节点（表示从根节点到该节点为一个完整字符串），如下图蓝色路径则为字符串 pedro 的查找路径。</p><img src=/Users/xzy/github.com/zhenyuxie/hugo-blog/content/images/database/lookup-trie.png alt="Lookup Trie" style=zoom:67%><p>Trie 的主要优点是：</p><ul><li>高效地插入和查找字符串，时间复杂度为 $O(k)$，其中 $k$ 是字符串的长度。</li><li>可以高效地进行前缀匹配，用于实现自动补全、单词搜索等。</li></ul><p>实际上，Trie 也可以用来存储数值类型的数据。对于 uint64 的数值，最大为 18,446,744,073,709,551,615。如果按字符来存储，那么存储 uint64 的最大值需要 17 层，显然这种存储方式并不高效，那么如果我们按 bits 存储呢？uint64 有 64-bits，每个节点的 key 用 8-bits 表示，那么只需要 8 层即可。</p><p>我们以每个节点存 2-bits 为例，假设 Trie 中存储了 7, 10, 12，从下图可以看到这三个数的二进制表示。每个节点的值由 0 和 1 组成，同时每个节点包含指向所有子节点的指针，指针为 * 代表该子节点存在，指针为 Ø 代表改子节点不存在。最终由叶子节点指向实际的数据。</p><img src=/Users/xzy/github.com/zhenyuxie/hugo-blog/content/images/database/2-bit-trie.png alt="2-bit Trie" style=zoom:50%><p>然而，我们可以很容易看出，上述 Trie 有两个缺点：</p><ol><li>有的节点只有一个子节点，既增加了层级也浪费了空间</li><li>有的节点存在大量空指针，浪费空间。</li></ol><p>为了解决上述问题，一般使用压缩技术来达到节约空间的目的。</p><h1 id=radix-tree>Radix tree</h1><p>Radix tree（基数树，也称为压缩前缀树或 Patricia 树）是一种特殊的多叉树数据结构，用于高效地存储、检索和查找字符串键（key）和与之相关联的值（value）。它被广泛用于实现诸如IP路由表、字典、自动补全和编译器等应用。</p><p>Radix tree 的思想是通过在垂直方向折叠只含有一个子节点的节点来达到压缩的效果，这个过程在论文里称为路径压缩（Path Compression）。如下：</p><img src=/Users/xzy/github.com/zhenyuxie/hugo-blog/content/images/database/path-compression.png alt=image-20230718232703604 style=zoom:50%><p>压缩后的节点需要将路径的前缀存储下来，如下：</p><img src=/Users/xzy/github.com/zhenyuxie/hugo-blog/content/images/database/2-bit-collapse-trie.png alt=2-bit-collapse-trie style=zoom:50%><p>前两层的节点都只有一个子节点，将它们折叠到第三层的节点，保存折叠路径的前缀 0000，形成一个新节点，如下所示：</p><img src=/Users/xzy/github.com/zhenyuxie/hugo-blog/content/images/database/2-bit-collapse-trie-result.png alt="2-bit Radix Tree" style=zoom:50%><p>查找时，遇到折叠过的节点，要比较前缀是否匹配。经过垂直压缩，减少了节点树和层级树，节约了大量空间，但是依然没有解决空指针浪费的问题。</p><h1 id=adaptive-radix-tree>Adaptive Radix Tree</h1><p>ART (自适应基数树) 的关键就在于 Adaptive 这个词，为了充分理解 ART 的设计精髓，我们还是以一个例子入手。我们以一个节点存 8-bits 为例，如下：</p><img src=/Users/xzy/github.com/zhenyuxie/hugo-blog/content/images/database/8-bit-radix-tree.png alt=8-bit-radix-tree style=zoom:50%><p>可以看到，节点将存 256（$2^8$）个指针，指针数组的下标代表子节点的值。整个节点占用的空间为 2048（256 * 8）bytes，然而实际有效的指针只有 3 个，也就意味着有 2024 （2048 - 24）bytes 浪费掉了。</p><p>为了解决上述空指针浪费的问题，ART 便应运而生。ART 的思路是提供 4 种不同类型的节点，并根据当前节点有效指针数量选取合适的节点类型。4 种节点类型如下：</p><img src=/Users/xzy/github.com/zhenyuxie/hugo-blog/content/images/database/art-node-type.png alt=image-20230718235416907 style=zoom:50%><p><strong>Node4</strong>，由一个长度为 4 的 byte 数组和长度为 4 的指针数组构成，最多存储 4 个不同的 key 及其对应的子节点指针。一共占用 40（4*1 + 4*8）bytes。有效指针个数小于等于 4 时，使用这种类型的节点存储如下：</p><img src=/Users/xzy/github.com/zhenyuxie/hugo-blog/content/images/database/art-4.png alt="Art Node 4" style=zoom:67%><p>查找时，需要遍历 byte 数组，判断当前要查找的 key 是否在数组中。由于数据长度小，遍历的开销也就很低。</p><p><strong>Node16</strong>，由一个长度为 16 的 byte 数组和长度为 16 的指针数组构成，最多存储 16 个不同的 key 及其对应的子节点指针。一共占用 144（16*1 + 16*8）bytes。有效指针个数在 5~16 时，使用这种类型的节点存储，如下：</p><img src=/Users/xzy/github.com/zhenyuxie/hugo-blog/content/images/database/art-16.png alt="Art Node 16" style=zoom:67%><p>节点查找流程和 Node4 相同。</p><p><strong>Node48</strong>，由一个长度为 256 的 byte 数组和长度为 48 的指针数组构成，最多存储 48 个不同的 key 及其对应的子节点指针。一共占用 640（256*1 + 48*8）bytes。有效指针个数在 17~48 时，使用这种类型的节点存储，如下：</p><img src=/Users/xzy/github.com/zhenyuxie/hugo-blog/content/images/database/art-48.png alt="Art Node 48" style=zoom:67%><p>由于 byte 数组和指针数组长度不对齐，需要通过一定的方式将它们映射起来：byte 数组的下标表示 key，值表示 key 对应的子节点指针在指针数组的位置。</p><p>那么为什么 Node48 不和 Node4、Node16 保持一样的设计呢？论文中给出了解释：随着节点中元素个数的增加，遍历查找 key 数组的开销越来越大，元素个数超过 16 后，存储方式便按 Node48 存储。</p><p>我们来看下 Node48 的查找过程，查找 Node48 时，我们可以跟据查找的 key 快速定位到其在节点中的位置（key的值便是下标值），获取其对应的子节点指针。时间复杂多为 O(1)，这是典型的空间换时间做法。</p><p><strong>Node256</strong>，由长度为 256 的指针数组构成，一共占用 2048（256 * 8）bytes。有效指针个数在 49~256 时，使用这种类型的节点存储，如下：</p><img src=/Users/xzy/github.com/zhenyuxie/hugo-blog/content/images/database/art-256.png alt="Art Node 256" style=zoom:50%><p>指针数组的下标代表 key，值代表其对应的子节点指针。查找是，可以快速得到子节点指针，时间复杂度为 O(1)。</p><p>因此对于前面的例子，则选取 Node4 存储，如下：</p><img src=/Users/xzy/github.com/zhenyuxie/hugo-blog/content/images/database/art-index-example.png alt="Art Index Example" style=zoom:50%><p>节点有一个空指针，浪费 8 bytes，比起用 Node256 来存储浪费 2024 bytes，已经减少了大量空间浪费。</p><h1 id=comparison>Comparison</h1><p>数据库常用的索引结构有 Hash 索引、B+ Tree 等，那么 ART 对比这些索引有什么优势呢？</p><p>ART 通过路径压缩、自适应节点分配极大的减少了空间浪费。相比 B+ Tree，其内部节点更小，占用空间更少，更适合 cpu cache，在纯内存场景，ART 优势明显。同时 ART 也拥有极佳的点查性能（最坏情况为 O(k)），也更适合前缀匹配查询。</p><p>B+ Tree 的优势在于树高度小且平衡，更适合作为传统数据库的磁盘索引。B+ Tree 能提供稳定高效的查询性能，且范围查询性能也很突出。因此作为磁盘索引，B+ Tree 更有优势。</p><p>Hash 索引常常能提供高效的点查性能，但是范围查询、前缀查询性能极差（全扫）。因此，Hash 索引常常用于加速点查，使用比较局限。</p><h1 id=conclusions>Conclusions</h1><p>通过本文的介绍，我们大致了解了 Adaptive Radix Tree 的原理和优势。在实际技术选型过程中，应该充分结合系统应用场景，根据各自的优势，选取相对合适的技术才能充分发挥系统的能力。</p><h1 id=reference>Reference</h1><ul><li><a href=https://en.wikipedia.org/wiki/Radix_tree title=https://en.wikipedia.org/wiki/Radix_tree rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://en.wikipedia.org/wiki/Radix_tree
<i class="fa fa-external-link-alt"></i></a></li><li><a href=https://db.in.tum.de/~leis/papers/ART.pdf title=https://db.in.tum.de/~leis/papers/ART.pdf rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://db.in.tum.de/~leis/papers/ART.pdf
<i class="fa fa-external-link-alt"></i></a></li><li><a href=https://duckdb.org/2022/07/27/art-storage.html title=https://duckdb.org/2022/07/27/art-storage.html rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://duckdb.org/2022/07/27/art-storage.html
<i class="fa fa-external-link-alt"></i></a></li></ul></div><footer class=post-footer><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right><ul><li class=post-copyright-title><strong>Post Title:</strong></li><li class=post-copyright-author><strong>Post Author:</strong>
debuger</li><li class=post-copyright-link><strong>Post Link:</strong>
<a id=post-cr-link href=/the-adaptive-radix-tree-artful-indexing-for-main-memory-databases/ title>/the-adaptive-radix-tree-artful-indexing-for-main-memory-databases/</a></li><li class=post-copyright-license><strong>Copyright Notice:</strong>
All articles in this blog are licensed under <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> unless stating additionally.</li></ul></div><div class=followme><span>Welcome to my other publishing channels</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/images/wechat_channel.jpg><span class=icon><i class="fab fa-weixin"></i></span>
<span class=label>WeChat</span></a></div><div class=social-item><a target=_blank class=social-link href=/atom.xml><span class=icon><i class="fa fa-rss"></i></span>
<span class=label>RSS</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/paper/ rel=next title><i class="fa fa-chevron-left"></i></a></div><div class="post-nav-prev post-nav-item"><a href=/wisckey-separating-keys-from-values-in-ssd-conscious-storage-%E8%AE%BA%E6%96%87%E8%A7%A3%E8%AF%BB/ rel=prev title><i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div id=comments class=post-comments><div class=comment-head><div class=comment-headline><i class="fas fa-comments fa-fw"></i>
<span>Comments</span></div></div><div class=comment-wrap><div><div class=comment-loading><i class="fa fa-sync fa-spin"></i></div><div class=giscus-container></div></div></div></div></div></main><footer class=footer><div class=footer-inner><div id=gtranslate class=google-translate><i class="fa fa-language"></i><div id=google_translate_element></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2010 - 2023</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=author itemprop=copyrightHolder>debuger</span></div><div class=powered-by>Power by <a href=https://gohugo.io title=0.109.0 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.4.0 target=_blank>Hugo NexT.Gemini</a></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"busuanzi":{"pageview":true},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Announcements","categoryid":"DIC_kwDOIqmyr84CTQGv","emit":false,"inputposition":"top","mapping":"title","reactions":true,"repo":"debuger6/zhenyuxie.github.io","repoid":"R_kgDOIqmyrw","theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"/","i18n":{"ds_day":" Day Ago","ds_days":" Day ","ds_hour":" Hour Ago","ds_hours":" Hour ","ds_just":"Just","ds_min":" Min Ago","ds_mins":" Min","ds_month":" Month Ago","ds_years":" Year ","empty":"We didn't find any results for the search: ${query}","hits":"","hits_time":"${hits} results found in ${time} ms","placeholder":"Searching..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":230},"statis":{"enable":true,"plugin":"busuanzi"},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.4.0","waline":{"cfg":{"comment":true,"emoji":false,"imguploader":false,"pageview":true,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","得意"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.37028fbafbd97fd89808b4c7b5a3a81f01ed0ab24001d273d774f9546a0e9170.js defer></script>
<script type=text/javascript src=/js/math.min.95d37ca8344f2f635c0f13f77cc75191efb6cdf99093ed73203a86e05f995fbb.js defer></script></body></html>